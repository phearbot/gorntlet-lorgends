pico-8 cartridge // http://www.pico-8.com
version 21
__lua__
-- loop
function _init()
 map_flags()
 init_player()
end

function _update60()
 player_update()
	player_actions()
end

function _draw()
 cls(0)
 draw_map()
 draw_player()
end

-->8
-- level
function map_flags()
 wall=0
end

function draw_map()
 map(0,0)
end

function tile_attr(tile_type,x,y)
 tile=mget(x,y)
 flags=fget(tile,tile_type)
 return flags
end

function can_move(x,y)
 return not tile_attr(wall,x,y)
end
-->8
-- player
-- ⬆️⬇️⬅️➡️❎ for use in sublime
function init_player()
 player={
  num=1, --player num for color
  x=5*8, -- pos in tiles 
  y=5*8, 
  sprite=34, -- spr id
  spritex=2, -- spr size 
  spritey=3,
  mirror=false,
  deltax=0, -- movement
  deltay=0,
  maxspeed=2,
  accel=0.5,
  moving=false,
  slide=false,
  friction=.85
 }
end

function draw_player()
 spr(player.sprite,player.x,player.y,player.spritex,player.spritey)
 pal_swap()
end

function player_update()
 --slow that fucker
 player.deltax*=player.friction
 player.deltay*=player.friction

 if btn(⬅️) then
  player.deltax-=player.accel
  player.moving=true
 end
 if btn(➡️) then
  player.deltax+=player.accel
  player.moving=true
 end
 if btn(⬆️) then
  player.deltay-=player.accel
  player.moving=true
 end
 if btn(⬇️) then
  player.deltay+=player.accel
  player.moving=true
 end

 if player.running
  and not btn(⬅️)
  and not btn(➡️)
  and not btn(⬆️)
  and not btn(⬇️) then
  player.moving=false
  player.slide=true
 end

 if player.sliding then
  if abs(player.dx)<.2
  or player.running then
    player.dx=0
    player.sliding=false
  end
 end

  player.x+=player.deltax
  player.y+=player.deltay

 --if (can_move(newx+newy))then
 -- player.x=mid(0,newx,127)
 -- player.y=mid(0,newy,63) -- dont get this bit
 --else
 -- sfx(0)
 --end
end

function player_actions()
 if(btnp(❎)) color_change() 
end

function color_change()
 if(player.num<4)then
  player.num+=1
 else
  player.num=1
 end
end

function pal_swap()
 if (player.num == 1) then
  --as it
  pal(3,3) pal(11,11)
 elseif (player.num == 2) then
  pal(3,1) pal(11,12)
 elseif (player.num == 3) then
  pal(3,4) pal(11,10)
 elseif (player.num == 4) then
  pal(3,2) pal(11,8)
 end
end

__gfx__
000000007617767777177777d75005000050057d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006d5777666dd77666d75005000050057d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dd5766dddd5ddd7dd65600000000656d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000dd1dd1dddd17761d15160001100061510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000077676d77777676d7d75005000050057d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000076666d7766666657d75005000050057d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000d166d1ddd1666d1dd65600000000656d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006d7777777d77777615160001100061510000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22222222dd77767665777766ddd1ddd1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
21111111d576666ddd7666dd77757775000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
21511151d1616dddd1661dd555515551000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
21111111766d77777766d77700660066000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2111111166dd77766666d77600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
211111116ddd7766666dd76655005500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
21511151dddddddddddddddd00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
21111111101010101010101000010001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000005555000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000055550000000000557777550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000557777550000000549f77f945000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000549f77f94500000059ffffff95000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00059ffffff9500000055ffffff55000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00055ffffff55000005f75555557f500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
005f75555557f5000056f777777f6500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0056f777777f65000001d6f77f6d1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001d6f77f6d1000000311d66d113000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000311d66d1130000bb5141111415bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0035141111415300b5bb31444413bb5b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03bb31444413b33035537b1111b73553000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
03337b1111b73110433dbbb33bbbd334000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
044dbbb33bbbd440f49355599555394f000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0ff9555995553ff00ff4434ff4334ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0ffd434ff43340000ff4144554414ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00045445544140000004155335514000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00041113355140000003331551333000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0001333551bb30000000331001330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00005550013300000000111001110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000011100000000d6d00d6d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000d6d00000000555005550000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000055500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0001010101000000000000000000000000010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0402010201020102010201020102010201020102010202030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0412111211121112111211121112111211121112111212030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0410101010101010101010101010101010101010101010030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0410101010101010101010101010101010101010101010030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0410101010101010101010101010101010101010101010030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0410101010101010101010101010101010101010101010030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0410101010101010101010101010101010101010101010030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0410101010101010101010101010101010101010101010030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0410101010101010101010101010101010101010101010030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0410101010101010101010101010101010101010101010030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0013131313131313131313131313131313131313131313000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000200000801003010030000900001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
